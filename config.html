<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Configuraci√≥n ‚Äî Tienda</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
<header>
  <div class="brand">
    <div class="logo">‚öôÔ∏è</div>
    <div>
      <h1>Configuraci√≥n del negocio</h1>
      <div class="small">Ajusta par√°metros para que los c√°lculos sean consistentes en todo el sistema.</div>
    </div>
  </div>

  <nav class="nav">
    <a href="index.html">Inicio</a>
    <a class="active" href="config.html">Config</a>
    <a href="lotes.html">Lotes</a>
    <a href="inventario.html">Inventario</a>
    <a href="ventas.html">Ventas</a>
    <a href="gastos.html">Gastos</a>
    <a href="reportes.html">Reportes</a>
  </nav>
</header>

<main>
  <section class="card">
    <h2>üëã C√≥mo usar esta pantalla</h2>
    <div class="small">
      ‚Ä¢ Aqu√≠ defines el <b>tipo de cambio</b>, el costo interno por <b>No retirado</b> y el costo fijo de <b>Mariita</b>.<br/>
      ‚Ä¢ Estos valores se aplican autom√°ticamente en costos y utilidades.<br/>
      ‚Ä¢ Consejo: cambia el tipo de cambio solo cuando de verdad cambie tu referencia (para mantener consistencia).
    </div>
  </section>

  <section class="grid cols2">
    <div class="card">
      <h2>üí± Tipo de cambio</h2>
      <div class="small">Convierte Quetzales (Q) a d√≥lares ($). Default recomendado: <b>7.50</b>.</div>
      <label>Tipo de cambio (Q ‚Üí $)</label>
      <input id="fx" type="number" step="0.01" placeholder="7.50"/>
      <div class="small" id="fxPreview" style="margin-top:10px"></div>
      <hr/>
      <div class="small muted">
        Consejo: si una prenda cuesta Q100 y fx=7.50, su costo base en $ ser√° 100/7.50 = $13.33 (sin aduana).
      </div>
    </div>

    <div class="card">
      <h2>üö´ Costos por ‚ÄúNo retirado‚Äù</h2>
      <div class="small">
        Este costo es interno (lo pagas t√∫) cuando el cliente no retira y t√∫ asumes la p√©rdida del env√≠o.
      </div>
      <label>No retirado ‚Äî destino fijo ($ por prenda)</label>
      <input id="noRetFixed" type="number" step="0.01" placeholder="1.00"/>
      <label>No retirado ‚Äî personalizado ($ por prenda)</label>
      <input id="noRetCustom" type="number" step="0.01" placeholder="3.00"/>
      <hr/>
      <div class="small muted">
        Consejo: este costo se aplica solo cuando el estado de la prenda pasa a <b>No retirado</b>.
      </div>
    </div>
  </section>

  <section class="grid cols2">
    <div class="card">
      <h2>üë©‚Äçüíº Mariita ‚Äî costo fijo por ayuda</h2>
      <div class="small">
        Mariita cobra un <b>monto fijo</b> los mi√©rcoles y s√°bados por cada ayuda que brinda en Metrogaler√≠as.
        Este costo se asigna a cada prenda al marcarla como <b>Retirado</b> o <b>Depositado</b>.
      </div>
      <label>Costo fijo Mariita ($ por prenda)</label>
      <input id="mariitaFixed" type="number" step="0.01" placeholder="0.00"/>
      <div class="small muted" style="margin-top:10px">
        Tip: si Mariita cobra por ‚Äúayuda‚Äù y esa ayuda incluye varias prendas, en la fase Pro agregamos ‚Äúpaquetes‚Äù
        para prorratear. Por ahora lo dejamos <b>por prenda</b> para que no se complique.
      </div>
    </div>

    <div class="card">
      <h2>üóìÔ∏è Dep√≥sitos</h2>
      <div class="small">D√≠as habituales de dep√≥sito para conciliaci√≥n interna.</div>
      <div class="flex" style="margin-top:10px">
        <span class="pill info">Mi√©rcoles</span>
        <span class="pill info">S√°bado</span>
      </div>
      <hr/>
      <div class="small muted">
        Consejo: marca <b>Depositado</b> solo cuando el dinero ya est√© confirmado. As√≠ tus reportes cuadran con caja.
      </div>
    </div>
  </section>

  <section class="card">
    <div class="flex">
      <button class="btn ok" id="btnSave">Guardar configuraci√≥n</button>
      <button class="btn" id="btnResetDefaults">Restaurar valores sugeridos</button>
      <span class="small" id="msg"></span>
    </div>
  </section>
</main>

<script src="app.js"></script>
<script>
  const db = loadDB();

  const fx = document.getElementById("fx");
  const noRetFixed = document.getElementById("noRetFixed");
  const noRetCustom = document.getElementById("noRetCustom");
  const mariitaFixed = document.getElementById("mariitaFixed");
  const fxPreview = document.getElementById("fxPreview");
  const msg = document.getElementById("msg");

  function render(){
    fx.value = db.config.fx ?? 7.50;
    noRetFixed.value = db.config.noRetFixed ?? 1.00;
    noRetCustom.value = db.config.noRetCustom ?? 3.00;
    mariitaFixed.value = db.config.mariitaFixed ?? 0.00;
    previewFX();
  }

  function previewFX(){
    const v = Number(fx.value || 7.50);
    const exampleQ = 100;
    const usd = exampleQ / v;
    fxPreview.innerHTML = `Ejemplo r√°pido: Q${exampleQ} ‚Üí <b>${money(usd)}</b>`;
  }

  fx.addEventListener("input", previewFX);

  document.getElementById("btnSave").addEventListener("click", ()=>{
    db.config.fx = Number(fx.value || 7.50);
    db.config.noRetFixed = Number(noRetFixed.value || 1.00);
    db.config.noRetCustom = Number(noRetCustom.value || 3.00);
    db.config.mariitaFixed = Number(mariitaFixed.value || 0.00);

    saveDB(db);
    msg.textContent = "‚úÖ Guardado.";
    setTimeout(()=>msg.textContent="", 1400);
  });

  document.getElementById("btnResetDefaults").addEventListener("click", ()=>{
    fx.value = 7.50;
    noRetFixed.value = 1.00;
    noRetCustom.value = 3.00;
    mariitaFixed.value = 0.00;
    previewFX();
  });

  render();
</script>
</body>
</html>
